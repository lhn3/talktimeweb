<template>
  <div :class="$style['list-column']">
    <div class="list-search">
      <el-input v-model="searchValue" placeholder="搜索" :prefix-icon="Search" clearable />
      <el-icon size="30"><CirclePlusFilled /></el-icon>
    </div>
    <div class="list-box">
      <div
        class="list-item"
        :style="{ backgroundColor: chattingId === item.id ? 'rgba(0,0,0,0.3)' : '' }"
        v-for="item in groupInfoList"
        :key="item.id"
        @click="handelClick(item.id)"
      >
        <el-avatar
          shape="circle"
          :size="50"
          fit="cover"
          :src="item.avatar || 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png'"
        />
        <div class="user-info">
          <div class="user-name text-nowrap">{{ item.userName }}</div>
          <div class="user-msg text-nowrap">{{ item.lastMessage }}</div>
        </div>
        <div class="send-time">{{ item.lastMessageTime }}</div>
      </div>
    </div>
  </div>
</template>
<script setup lang="ts">
  import { ref, defineProps, defineEmits, nextTick } from 'vue'
  import { Search } from '@element-plus/icons-vue'
  import { scrollTo } from '@/utils/utils'
  import { useOtherStore } from '@/stores'

  const other = useOtherStore()
  const emit = defineEmits(['changeChattingId'])
  const props = defineProps({
    // 列表信息
    groupInfoList: {
      type: Array,
      default: () => []
    },
    // 正在聊天的人id
    chattingId: {
      type: Number,
      required: true
    }
  })

  /**选择某个人聊天*/
  const handelClick = (id: number) => {
    emit('changeChattingId', id)
    // 滚动到最底部
    nextTick(() => scrollTo(other.otherInfo.chattingBodyDom))
  }

  const searchValue = ref<any>()
</script>
<style module lang="scss">
  .list-column {
    height: 100%;
    width: 20vw;
    min-width: 240px;
    background-color: $primary-color2;
    :global {
      .list-search {
        width: 100%;
        height: 65px;
        border-bottom: 1px solid $primary-color;
        display: flex;
        align-items: center;
        padding: 0 20px;
        .el-input__wrapper {
          margin-right: 10px;
          border-radius: 16px;
          box-shadow: none;
          background-color: $primary-color;
          .el-input__inner {
            color: $primary-color3;
            --el-input-placeholder-color: $primary-color3;
          }
          .el-icon {
            color: $primary-color3;
          }
        }
        .el-icon {
          cursor: pointer;
          color: $primary-color;
        }
      }
      .list-box {
        width: 100%;
        height: calc(100% - 65px);
        overflow-y: scroll;
        overflow-x: hidden;
        //background-color: #999999;
        .list-item {
          user-select: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          padding: 8px;
          margin: 5px;
          border-radius: 8px;
          background-color: rgba(225, 225, 225, 0.1);
          transition: all 0.3s;
          .user-info {
            flex: 1;
            margin: 0 10px;
            .user-name {
              color: #fff;
              font-size: 15px;
              line-height: 30px;
            }
            .user-msg {
              color: #999;
              font-size: 13px;
            }
          }
          .send-time {
            color: #999;
            font-size: 13px;
          }
        }
        .list-item:hover {
          background-color: rgba(225, 225, 225, 0.3);
        }
      }
    }
  }
</style>
