<template>
  <div :class="$style['chatting-column']">
    <!--聊天盒子-->
    <div class="chatting-box" v-show="group === 0">
      <!--头部-->
      <div class="chatting-header">
        <div class="chatting-title">{{ messageOrUserInfo.userName }}</div>
        <div class="more-info" @click="() => user.changeShowMore()">
          <el-icon><MoreFilled /></el-icon>
        </div>
      </div>
      <!--内容-->
      <chatting-body :message-list="messageOrUserInfo.messageList || []" ref="chattingBodyRef" />
      <!--底部-->
      <control-bar :chatting-id="chattingId" />
    </div>

    <!--用户信息-->
    <div class="user-info" v-show="group === 1">
      <user-info-card v-if="messageOrUserInfo.id" :user-info="messageOrUserInfo" :send="true" :del="true" />
    </div>
  </div>
</template>
<script setup lang="ts">
  import { onMounted, ref, defineProps } from 'vue'
  import { useUserStore, useOtherStore } from '@/stores'
  import { scrollTo } from '@/utils/utils'
  import ControlBar from '@/views/components/chatting-column/cpns/control-bar/index.vue'
  import ChattingBody from '@/views/components/chatting-column/cpns/chatting-body/index.vue'
  import UserInfoCard from '@/components/user-info-card/user-info-card.vue'

  const chattingBodyRef = ref()
  const user = useUserStore()
  const other = useOtherStore()
  const props = defineProps({
    //正在聊天的信息和消息列表/用户信息
    messageOrUserInfo: {
      type: Object,
      default: () => ({})
    },
    // 正在聊天的id
    chattingId: {
      type: Number,
      required: true
    },
    group: {
      type: Number,
      required: true
    }
  })

  onMounted(() => {
    // 滚动到最底部
    scrollTo(chattingBodyRef.value.$el)
    //将dom记录到vue
    other.otherInfo.chattingBodyDom = chattingBodyRef.value.$el
  })
</script>

<style module lang="scss">
  .chatting-column {
    height: 100%;
    width: 50vw;
    min-width: 540px;
    color: #fff;
    //background-color: $chat-body-color;
    background: radial-gradient(circle at 60% 90%, rgba($primary-color, 1), transparent 60%),
      radial-gradient(circle at 20px 20px, rgba($primary-color, 0.8), transparent 25%), $chat-body-color;
    display: flex;
    align-items: center;
    justify-content: center;
    :global {
      .chatting-box {
        background-color: $chat-body-color;
        height: 100%;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        .chatting-header {
          border-radius: 10px;
          margin-top: 5px;
          width: calc(100% - 10px);
          padding: 0 20px;
          background-color: $chat-header-color;
          display: flex;
          align-items: center;
          box-shadow: 0 5px 8px 0 rgba(#000, 0.5);
          .chatting-title {
            line-height: 60px;
            font-size: 18px;
          }
          .more-info {
            cursor: pointer;
            margin-left: auto;
            color: #eee;
            font-size: 22px;
          }
        }
      }
      .user-info {
        width: 400px;
      }
    }
  }
</style>
