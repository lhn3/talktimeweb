<template>
  <div :class="$style['control-bar']">
    <!--语音键盘输入-->
    <div class="icon-style" @click="changeInputType">
      <svg-icon :name="state.inputType ? 'icon-jianpan1' : 'icon-yuyin'" size="22px" />
    </div>

    <!--输入框-->
    <input-control v-if="state.inputType" v-model="state.inputValue" @submit="send" />
    <!--语音框-->
    <speak-control v-else />

    <!--表情包-->
    <emoji-control @selectEmoji="value => (state.inputValue += value)" />

    <!--艾特-->
    <div class="icon-style">
      <svg-icon name="icon-aite1" size="22px" color="#eee" />
    </div>

    <!--图片-->
    <div class="icon-style">
      <svg-icon name="icon-tupian" size="22px" />
    </div>

    <!--文件-->
    <div class="icon-style">
      <svg-icon name="icon-wenjianguanli" size="22px" />
    </div>

    <div class="line"></div>

    <!--发送-->
    <div
      @click="send"
      class="icon-style"
      :style="{ backgroundColor: state.inputValue.trim() ? '#6d5b85' : 'transparent', width: '32px' }"
    >
      <svg-icon
        name="icon-zhifeiji"
        size="25px"
        :svg-style="`
          transform: rotate(${state.inputValue.trim() ? 45 : 0}deg);
          transition: all 0.3s;
          cursor: ${state.inputValue.trim() ? 'pointer' : 'unset'}
        `"
      />
    </div>
  </div>
</template>
<script setup lang="ts">
  import { nextTick, reactive, ref } from 'vue'
  import InputControl from '@/views/components/chatting-column/cpns/control-bar/cpns/input-control.vue'
  import SpeakControl from '@/views/components/chatting-column/cpns/control-bar/cpns/speak-control.vue'
  import EmojiControl from '@/views/components/chatting-column/cpns/control-bar/cpns/emoji-control.vue'
  import { useUserStore, useOtherStore } from '@/stores'
  import { scrollTo } from '@/utils/utils'

  const user = useUserStore()
  const other = useOtherStore()
  const state = reactive({
    inputType: 1, //1键盘输入，2语音输入
    inputValue: ''
  })

  /**改变输入状态*/
  const changeInputType = () => {
    if (state.inputType) {
      state.inputType = 0
    } else {
      state.inputType = 1
    }
  }

  const send = () => {
    // 发送并清空输入框内容
    user.userInfo.messageList.push({
      id: 8,
      self: true,
      avatar: 'https://picsum.photos/300/300?id=4',
      userName: '西兰花',
      address: '杭州',
      time: '11:48',
      message: state.inputValue
    })
    // 滚动到最底部
    nextTick(() => scrollTo(other.otherInfo.chattingBodyDom))
    state.inputValue = ''
  }
</script>
<style module lang="scss">
  .control-bar {
    width: calc(100% - 20px);
    display: flex;
    align-items: center;
    background-color: $chat-input-color;
    border-radius: 10px;
    margin-bottom: 10px;
    padding: 5px;
    box-shadow: 0 -5px 8px 0 rgba(#000, 0.3);
    :global {
      //子组件继承此样式
      .icon-style {
        height: 28px;
        min-width: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: transparent;
        transition: all 0.3s;
        border-radius: 5px;
      }
      .icon-style:hover {
        background-color: $primary-color3;
      }

      .line {
        height: 16px;
        width: 1px;
        background-color: $chat-body-color;
        margin: 0 5px;
      }
    }
  }
</style>
